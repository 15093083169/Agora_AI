<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å£°ç½‘å¯¹è¯å¼AIå¼•æ“æ¼”ç¤º</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 5px;
        }
        .status-active {
            background-color: #28a745;
        }
        .status-inactive {
            background-color: #dc3545;
        }
        .debug-panel {
            height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 0.85rem;
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            padding: 10px;
            margin-top: 20px;
        }
        pre {
            background-color: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            white-space: pre-wrap;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <!-- <h1 class="text-center mb-4">å£°ç½‘å¯¹è¯å¼AIå¼•æ“ - ç®€åŒ–ç‰ˆ</h1> -->
        
        <!-- è°ƒè¯•çª—å£åˆ‡æ¢æŒ‰é’® -->
        <!-- <div class="text-end mb-3">
            <button class="btn btn-outline-secondary btn-sm" onclick="toggleDebugSection()">
                ğŸ” è°ƒè¯•çª—å£
            </button>
        </div> -->
        
        <div class="row justify-content-center">
            <div class="col-md-6" id="mainContent">
                <div class="card mb-4">
                    <div class="card">
                    <div class="card-header">
                            <h5>é…ç½®å‚æ•°</h5>
                    </div>
                    <div class="card-body">
                                                    <form id="configForm">
                            <!-- æ™ºèƒ½ä½“RTC UIDæ˜¯å›ºå®šå€¼ï¼Œéšè—è¾“å…¥æ¡†ä½†ä¿ç•™å€¼ -->
                            <input type="hidden" id="agentRtcUid" value="26444">
                            
                            <!-- å£°ç½‘TokenæŠ˜å å¡ç‰‡ -->
                            <div class="accordion mb-3" id="agoraTokenAccordion">
                                <div class="accordion-item">
                                    <h2 class="accordion-header" id="agoraTokenHeader">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#agoraTokenCollapse" aria-expanded="false" aria-controls="agoraTokenCollapse">
                                            å£°ç½‘Token
                                        </button>
                                    </h2>
                                    <div id="agoraTokenCollapse" class="accordion-collapse collapse" aria-labelledby="agoraTokenHeader" data-bs-parent="#agoraTokenAccordion">
                                        <div class="accordion-body">
                        <div class="mb-3">
                                                <label class="form-label">Tokenè·å–æ–¹å¼</label>
                                                <div>
                                                    <div class="form-check form-check-inline">
                                                        <input class="form-check-input" type="radio" name="agoraTokenType" id="agoraTokenTypeTemp" value="temp" checked>
                                                        <label class="form-check-label" for="agoraTokenTypeTemp">ä¸´æ—¶Token</label>
                        </div>
                                                    <div class="form-check form-check-inline">
                                                        <input class="form-check-input" type="radio" name="agoraTokenType" id="agoraTokenTypeApi" value="api">
                                                        <label class="form-check-label" for="agoraTokenTypeApi">åç«¯è·å–Token</label>
                        </div>
                                                </div>
                                            </div>
                                            <div class="mb-3" id="agoraTokenInputBox">
                                                <label for="agoraToken" class="form-label">ä¸´æ—¶Token</label>
                                                <input type="text" class="form-control" id="agoraToken" placeholder="è¯·è¾“å…¥ä¸´æ—¶Token">
                                                <div class="form-text">è·å–åœ°å€ï¼šhttps://console.shengwang.cn/overview</div>
                                            </div>
                                            <div class="mb-3" id="agoraChannelNameBox">
                                                <label for="channelName" class="form-label">é¢‘é“åç§°</label>
                                                <input type="text" class="form-control" id="channelName" placeholder="è¯·è¾“å…¥é¢‘é“åç§°">
                                                <div class="form-text">é¢‘é“åç§°éœ€ä¸ç”ŸæˆTokenæ—¶ä¸€è‡´</div>
                                            </div>
                                            <div class="mb-3" id="agoraTokenUrlBox" style="display:none;">
                                                <label for="agoraTokenUrl" class="form-label">Tokenè·å–åœ°å€</label>
                                                <input type="text" class="form-control" id="agoraTokenUrl" value="http://localhost:8081/rtcToken" placeholder="è¯·è¾“å…¥Tokenè·å–æ¥å£åœ°å€">
                                                <div class="form-text">éƒ¨ç½²åç«¯tokenæœåŠ¡åè¾“å…¥</div>
                                            </div>
                                        </div>
                        </div>
                    </div>
                </div>

                                <!-- LLMé…ç½® -->
                                <div class="accordion mb-3" id="llmAccordion">
                                    <div class="accordion-item">
                                        <h2 class="accordion-header" id="llmHeader">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#llmCollapse" aria-expanded="false" aria-controls="llmCollapse">
                                                LLM (å¤§æ¨¡å‹) é…ç½®
                                            </button>
                                        </h2>
                                        <div id="llmCollapse" class="accordion-collapse collapse" aria-labelledby="llmHeader" data-bs-parent="#llmAccordion">
                                            <div class="accordion-body">
                        <div class="mb-3">
                                                    <label for="llmUrl" class="form-label">APIåœ°å€ <span class="text-danger" >*</span></label>
                                                    <input type="text" class="form-control" id="llmUrl" value="https://ark.cn-beijing.volces.com/api/v3/chat/completions">
                    </div>
                        <div class="mb-3">
                                                    <label for="llmApiKey" class="form-label">APIå¯†é’¥ <span class="text-danger">*</span></label>
                                                    <input type="text" class="form-control" id="llmApiKey">
                        </div>
                                                <div class="mb-3">
                                                    <label for="llmModel" class="form-label">æ¨¡å‹åç§° <span class="text-danger">*</span></label>
                                                    <input type="text" class="form-control" id="llmModel">
                        </div>
                                                <div class="mb-3">
                                                    <label for="llmPrompt" class="form-label">ç³»ç»Ÿæç¤ºè¯</label>
                                                    <textarea class="form-control" id="llmPrompt" rows="3"></textarea>
                            </div>
                                                <div class="mb-3">
                                                    <label for="llmGreeting" class="form-label">é—®å€™è¯­</label>
                                                    <input type="text" class="form-control" id="llmGreeting">
                                                </div>
                                                <!-- <div class="mb-3">
                                                    <label for="llmMaxToken" class="form-label">æœ€å¤§Tokenæ•°</label>
                                                    <input type="number" class="form-control" id="llmMaxToken" value="10240">
                                                </div> -->
                                            </div>
                        </div>
                    </div>
                </div>

                                <!-- VADé…ç½® -->
                                <div class="accordion mb-3" id="vadAccordion">
                                    <div class="accordion-item">
                                        <h2 class="accordion-header" id="vadHeader">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#vadCollapse" aria-expanded="false" aria-controls="vadCollapse">
                                                VAD (è¯­éŸ³æ´»åŠ¨æ£€æµ‹) é…ç½®
                                            </button>
                                        </h2>
                                        <div id="vadCollapse" class="accordion-collapse collapse" aria-labelledby="vadHeader" data-bs-parent="#vadAccordion">
                                            <div class="accordion-body">
                                                                                            <div class="mb-3">
                                                <label for="vadInterruptDuration" class="form-label">
                                                    äººå£°æŒç»­é˜ˆå€¼ (ms)
                                                    <i class="bi bi-question-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="æŒç»­æ£€æµ‹åˆ°äººå£°ä¿¡å·çš„æœ€å°æ—¶é—´é•¿åº¦ï¼Œäººå£°æŒç»­æ—¶é•¿è¶…è¿‡è¯¥æ•°å€¼æ—¶è§†ä¸ºæœ‰å£°è¾“å…¥ï¼Œé¿å…è¯¯æ‰“æ–­ã€‚å–å€¼120-1200"></i>
                                                </label>
                                                <input type="number" class="form-control" id="vadInterruptDuration" value="220">
                    </div>
                        <div class="mb-3">
                                                <label for="vadPrefixPadding" class="form-label">
                                                    å‰ç¼€å¡«å……é˜ˆå€¼ (ms)
                                                    <i class="bi bi-question-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="å¼€å§‹æ–°çš„è¯­éŸ³ç‰‡æ®µæ‰€éœ€çš„æœ€çŸ­è¯­éŸ³æŒç»­æ—¶é—´ï¼Œé¿å…éå¸¸çŸ­çš„å£°éŸ³è§¦å‘è¯­éŸ³æ´»åŠ¨æ£€æµ‹ã€‚å–å€¼0-5000"></i>
                                                </label>
                                                <input type="number" class="form-control" id="vadPrefixPadding" value="460">
                        </div>
                                            <div class="mb-3">
                                                <label for="vadSilenceDuration" class="form-label">
                                                    é™éŸ³æŒç»­é˜ˆå€¼ (ms)
                                                    <i class="bi bi-question-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="è¯­éŸ³ç»“æŸæ—¶çš„æœ€çŸ­é™éŸ³æŒç»­æ—¶é—´ï¼Œç¡®ä¿çŸ­æš‚çš„åœé¡¿ä¸ä¼šè¿‡æ—©ç»“æŸè¯­éŸ³ç‰‡æ®µã€‚å–å€¼0-2000"></i>
                                                </label>
                                                <input type="number" class="form-control" id="vadSilenceDuration" value="190">
                        </div>
                                            <div class="mb-3">
                                                <label for="vadThreshold" class="form-label">
                                                    çµæ•åº¦
                                                    <i class="bi bi-question-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="aiè¯†åˆ«äººå£°çš„çµæ•åº¦ï¼Œè¶Šä½è¶Šçµæ•ï¼Œå–å€¼0-1"></i>
                                                </label>
                                                <input type="number" class="form-control" id="vadThreshold" value="0.15" step="0.01" min="0" max="1">
                                            </div>
                                                <div class="mb-3">
                                           
                                                        <input class="form-check-input" type="checkbox" id="vadEnableAivad" checked>
                                                        <label class="form-check-label" for="vadEnableAivad">
                                                            å¯ç”¨ä¼˜é›…æ‰“æ–­
                                                            <i class="bi bi-question-circle text-muted ms-1" data-bs-toggle="tooltip" data-bs-placement="top" title="å¯ç”¨åï¼Œä¼šå…è®¸ç”¨æˆ·è¯´è¯æ—¶ï¼Œæ‰“æ–­aiè¯´è¯"></i>
                                                        </label>
                                                    </div>
                                                
                                            </div>
                        </div>
                    </div>
                </div>

                                                            <!-- TTSé…ç½® -->
                            <div class="accordion mb-3" id="ttsAccordion">
                                <div class="accordion-item">
                                    <h2 class="accordion-header" id="ttsHeader">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#ttsCollapse" aria-expanded="false" aria-controls="ttsCollapse">
                                            TTS (è¯­éŸ³åˆæˆ) é…ç½®
                                        </button>
                                    </h2>
                                    <div id="ttsCollapse" class="accordion-collapse collapse" aria-labelledby="ttsHeader" data-bs-parent="#ttsAccordion">
                                        <div class="accordion-body">
                                            <div class="mb-3">
                                                <label for="ttsVendor" class="form-label">æœåŠ¡å•† <span class="text-danger">*</span></label>
                                                <select class="form-select" id="ttsVendor">
                                                    <option value="bytedance">ç«å±±å¼•æ“</option>
                                                    <option value="tencent">è…¾è®¯äº‘</option>
                                                </select>
                    </div>
                                            
                                            <!-- ç«å±±å¼•æ“é…ç½® -->
                                            <div id="ttsBytedanceConfig">
                            <div class="mb-3">
                                                    <label for="ttsToken" class="form-label" >AccessToken<span class="text-danger">*</span></label>
                                                    <div class="form-text">è·å–åœ°å€ï¼šhttps://console.volcengine.com/speech/</div>
                                                    <input type="text" class="form-control" id="ttsToken">
                            </div>
                            <div class="mb-3">
                                                    <label for="ttsAppId" class="form-label">APPID <span class="text-danger">*</span></label>
                                                    <input type="text" class="form-control" id="ttsAppId">
                            </div>
                            <div class="mb-3">
                                                    <label for="ttsCluster" class="form-label">ClusterID</label>
                                                    <input type="text" class="form-control" id="ttsCluster" value="volcano_tts">
                            </div>
                            <div class="mb-3">
                                                    <label for="ttsVoiceType" class="form-label">voice_type</label>
                                                    <input type="text" class="form-control" id="ttsVoiceType" value="">
                            </div>
                            <div class="mb-3">
                                                    <label for="ttsSpeedRatio" class="form-label">è¯­é€Ÿæ¯”ä¾‹</label>
                                                    <input type="number" class="form-control" id="ttsSpeedRatio" value="1.2" step="0.1" min="0.1" max="5">
                            </div>
                            <div class="mb-3">
                                                    <label for="ttsVolumeRatio" class="form-label">éŸ³é‡æ¯”ä¾‹</label>
                                                    <input type="number" class="form-control" id="ttsVolumeRatio" value="1" step="0.1" min="0.1" max="5">
                            </div>
                            <div class="mb-3">
                                                    <label for="ttsPitchRatio" class="form-label">éŸ³è°ƒæ¯”ä¾‹</label>
                                                    <input type="number" class="form-control" id="ttsPitchRatio" value="1" step="0.1" min="0.1" max="5">
                            </div>
                                            </div>
                                            
                                            <!-- è…¾è®¯äº‘é…ç½® -->
                                            <div id="ttsTencentConfig" style="display: none;">
                            <div class="mb-3">
                                                    <label for="ttsTencentAppId" class="form-label">APPID <span class="text-danger">*</span></label>
                                                    <div class="form-text">è·å–åœ°å€ï¼šhttps://console.cloud.tencent.com/cam/capi</div>
                                                    <input type="text" class="form-control" id="ttsTencentAppId">
                            </div>
                            <div class="mb-3">
                                                    <label for="ttsTencentSecretId" class="form-label">SecretId <span class="text-danger">*</span></label>
                                                    <input type="text" class="form-control" id="ttsTencentSecretId">
                            </div>
                            <div class="mb-3">
                                                    <label for="ttsTencentSecretKey" class="form-label">SecretKey <span class="text-danger">*</span></label>
                                                    <input type="text" class="form-control" id="ttsTencentSecretKey">
                            </div>
                            <div class="mb-3">
                                                    <label for="ttsTencentVoiceType" class="form-label">éŸ³è‰² ID</label>
                                                    <input type="number" class="form-control" id="ttsTencentVoiceType" value="601005">
                            </div>
                            <div class="mb-3">
                                                    <label for="ttsTencentSpeed" class="form-label">è¯­é€Ÿ</label>
                                                    <input type="number" class="form-control" id="ttsTencentSpeed" value="1.25" step="0.1" min="0.1" max="5">
                            </div>
                            <div class="mb-3">
                                                    <label for="ttsTencentVolume" class="form-label">éŸ³é‡</label>
                                                    <input type="number" class="form-control" id="ttsTencentVolume" value="5" min="0" max="20">
                                                </div>
                                                <div class="mb-3">
                                                    <label for="ttsTencentEmotionCategory" class="form-label">æƒ…æ„Ÿç±»åˆ«</label>
                                                    <select class="form-select" id="ttsTencentEmotionCategory">
                                                        <option value="happy">å¼€å¿ƒ</option>
                                                        <option value="sad">æ‚²ä¼¤</option>
                                                        <option value="angry">æ„¤æ€’</option>
                                                        <option value="fear">ææƒ§</option>
                                                        <option value="disgust">åŒæ¶</option>
                                                        <option value="surprise">æƒŠè®¶</option>
                                                        <option value="neutral">ä¸­æ€§</option>
                                                    </select>
                                                </div>
                                                <div class="mb-3">
                                                    <label for="ttsTencentEmotionIntensity" class="form-label">æƒ…æ„Ÿå¼ºåº¦</label>
                                                    <input type="number" class="form-control" id="ttsTencentEmotionIntensity" value="100" min="0" max="100">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
    
                                <div class="d-grid">
                                    <button type="button" class="btn btn-primary" id="saveConfigBtn">ä¿å­˜é…ç½®</button>
                            </div>
                        </form>
                    </div>
                </div>
                    <div class="card-header">
                        <h5>æ™ºèƒ½ä½“æ§åˆ¶</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <span class="status-indicator" id="agentStatusIndicator"></span>
                            <span id="agentStatusText">æœªåˆ›å»º</span>
                        </div>
                        <div class="mb-3">
                            <strong>æ™ºèƒ½ä½“ID: </strong><span id="agentId">æœªåˆ›å»º</span>
                        </div>
                        <div class="d-grid gap-2">
                            <button class="btn btn-success" id="createAgentBtn">åˆ›å»ºæ™ºèƒ½ä½“</button>
                            <button class="btn btn-danger" id="stopAgentBtn" disabled>åœæ­¢æ™ºèƒ½ä½“</button>
                    </div>
                </div>
            </div>
            
                <div class="card mb-4">
                    <div class="card-header">
                        <h5>éŸ³é¢‘äº¤äº’</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <span class="status-indicator" id="audioStatusIndicator"></span>
                            <span id="audioStatusText">æœªè¿æ¥</span>
                        </div>
                        <div class="d-grid gap-2">
                            <button class="btn btn-primary" id="startAudioBtn" disabled>å¼€å§‹å¯¹è¯</button>
                            <button class="btn btn-secondary" id="stopAudioBtn" disabled>ç»“æŸå¯¹è¯</button>
                        </div>
                        <div class="mt-3">
                            <div class="progress">
                                <div id="volumeIndicator" class="progress-bar" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                            <small class="text-muted">éŸ³é‡æŒ‡ç¤ºå™¨</small>
                        </div>
                    </div>
                </div>

              
            </div>
            
            <div class="col-md-6" id="debugSection" style="display: none;">
                <div class="card mb-4">
                    <div class="card-header">
                        <h5>æ—¥å¿—é¢æ¿</h5>
                    </div>
                    <div class="card-body">
                        <div class="debug-panel" id="debugPanel"></div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h5>è¯·æ±‚/å“åº”è¯¦æƒ…</h5>
                    </div>
                    <div class="card-body">
                        <ul class="nav nav-tabs" id="detailsTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="request-tab" data-bs-toggle="tab" data-bs-target="#request" type="button" role="tab">è¯·æ±‚</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="response-tab" data-bs-toggle="tab" data-bs-target="#response" type="button" role="tab">å“åº”</button>
                            </li>
                        </ul>
                        <div class="tab-content mt-2" id="detailsTabContent">
                            <div class="tab-pane fade show active" id="request" role="tabpanel">
                                <pre id="requestContent">å°šæœªå‘é€è¯·æ±‚</pre>
                            </div>
                            <div class="tab-pane fade" id="response" role="tabpanel">
                                <pre id="responseContent">å°šæœªæ”¶åˆ°å“åº”</pre>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://download.agora.io/sdk/release/AgoraRTC_N.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script>
        $(document).ready(function() {
            let agentId = null;
            let config = {};
            
            // ä»æœåŠ¡å™¨æ³¨å…¥çš„ç¯å¢ƒå˜é‡è¯»å–æ•æ„Ÿé…ç½®
            // è¿™äº›å€¼ç”±Node.jsæœåŠ¡å™¨ä».envæ–‡ä»¶è¯»å–å¹¶æ³¨å…¥
            const ENV_CONFIG = {
                appId: window.ENV_CONFIG?.AGORA_APP_ID || '',
                clientId: window.ENV_CONFIG?.AGORA_CLIENT_ID || '',
                clientSecret: window.ENV_CONFIG?.AGORA_CLIENT_SECRET || ''
            };
            
            // æ£€æŸ¥ç¯å¢ƒå˜é‡æ˜¯å¦å·²æ­£ç¡®åŠ è½½
            function checkEnvConfig() {
                if (!ENV_CONFIG.appId || !ENV_CONFIG.clientId || !ENV_CONFIG.clientSecret) {
                    logError('ç¯å¢ƒå˜é‡æœªæ­£ç¡®åŠ è½½ï¼Œè¯·æ£€æŸ¥.envæ–‡ä»¶é…ç½®');
                    $('#createAgentBtn').prop('disabled', true);
                    return false;
                }
                logDebug('ç¯å¢ƒå˜é‡åŠ è½½æˆåŠŸ');
                return true;
            }
            
            // è·å–è¡¨å•æ•°æ®å¹¶ä¿å­˜åˆ°configå¯¹è±¡
            function saveConfig(showToastMessage = false) {
                const ttsVendor = $('#ttsVendor').val();
                let ttsConfig = {};
                
                if (ttsVendor === 'bytedance') {
                    // ç«å±±å¼•æ“é…ç½®
                    ttsConfig = {
                        vendor: 'bytedance',
                        params: {
                            token: $('#ttsToken').val(),
                            app_id: $('#ttsAppId').val(),
                            cluster: $('#ttsCluster').val(),
                            voice_type: $('#ttsVoiceType').val(),
                            speed_ratio: $('#ttsSpeedRatio').val(),
                            volume_ratio: $('#ttsVolumeRatio').val(),
                            pitch_ratio: $('#ttsPitchRatio').val(),
                            emotion: ""
                        }
                    };
                } else if (ttsVendor === 'tencent') {
                    // è…¾è®¯äº‘é…ç½®
                    ttsConfig = {
                        vendor: 'tencent',
                        params: {
                            app_id: $('#ttsTencentAppId').val(),
                            secret_id: $('#ttsTencentSecretId').val(),
                            secret_key: $('#ttsTencentSecretKey').val(),
                            voice_type: parseInt($('#ttsTencentVoiceType').val()),
                            speed: parseFloat($('#ttsTencentSpeed').val()),
                            volume: parseInt($('#ttsTencentVolume').val()),
                            emotion_category: $('#ttsTencentEmotionCategory').val(),
                            emotion_intensity: parseInt($('#ttsTencentEmotionIntensity').val())
                        }
                    };
                }
                
                // æ ¡éªŒTokenè·å–æ–¹å¼
                const tokenType = $('input[name="agoraTokenType"]:checked').val();
                let agoraToken = '';
                let agoraTokenUrl = '';
                let channelName = '';
                
                if (showToastMessage) {
                    // æ ¡éªŒTokenç›¸å…³å­—æ®µ
                    if (tokenType === 'temp') {
                        agoraToken = $('#agoraToken').val().trim();
                        channelName = $('#channelName').val().trim();
                        if (!agoraToken) {
                            showToast('è¯·å¡«å†™ä¸´æ—¶Tokenï¼', 'error');
                            return;
                        }
                        if (!channelName) {
                            showToast('è¯·å¡«å†™é¢‘é“åç§°ï¼', 'error');
                            return;
                        }
                    } else {
                        agoraTokenUrl = $('#agoraTokenUrl').val().trim();
                        if (!agoraTokenUrl) {
                            showToast('è¯·å¡«å†™Tokenè·å–åœ°å€ï¼', 'error');
                            return;
                        }
                    }
                    
                    // æ ¡éªŒLLMå¿…å¡«å­—æ®µ
                    const llmUrl = $('#llmUrl').val().trim();
                    const llmApiKey = $('#llmApiKey').val().trim();
                    const llmModel = $('#llmModel').val().trim();
                    
                    if (!llmUrl) {
                        showToast('è¯·å¡«å†™LLM APIåœ°å€ï¼', 'error');
                        return;
                    }
                    if (!llmApiKey) {
                        showToast('è¯·å¡«å†™LLM APIå¯†é’¥ï¼', 'error');
                        return;
                    }
                    if (!llmModel) {
                        showToast('è¯·å¡«å†™LLMæ¨¡å‹åç§°ï¼', 'error');
                        return;
                    }
                    
                    // æ ¡éªŒTTSå¿…å¡«å­—æ®µ
                    const ttsVendor = $('#ttsVendor').val();
                    if (ttsVendor === 'bytedance') {
                        const ttsToken = $('#ttsToken').val().trim();
                        const ttsAppId = $('#ttsAppId').val().trim();
                        
                        if (!ttsToken) {
                            showToast('è¯·å¡«å†™ç«å±±å¼•æ“Tokenï¼', 'error');
                            return;
                        }
                        if (!ttsAppId) {
                            showToast('è¯·å¡«å†™ç«å±±å¼•æ“åº”ç”¨IDï¼', 'error');
                            return;
                        }
                    } else if (ttsVendor === 'tencent') {
                        const ttsTencentAppId = $('#ttsTencentAppId').val().trim();
                        const ttsTencentSecretId = $('#ttsTencentSecretId').val().trim();
                        const ttsTencentSecretKey = $('#ttsTencentSecretKey').val().trim();
                        
                        if (!ttsTencentAppId) {
                            showToast('è¯·å¡«å†™è…¾è®¯äº‘åº”ç”¨IDï¼', 'error');
                            return;
                        }
                        if (!ttsTencentSecretId) {
                            showToast('è¯·å¡«å†™è…¾è®¯äº‘SecretIdï¼', 'error');
                            return;
                        }
                        if (!ttsTencentSecretKey) {
                            showToast('è¯·å¡«å†™è…¾è®¯äº‘SecretKeyï¼', 'error');
                            return;
                        }
                    }
                } else {
                    // åˆå§‹åŒ–æ—¶ä¸æ ¡éªŒ
                    agoraToken = $('#agoraToken').val().trim();
                    agoraTokenUrl = $('#agoraTokenUrl').val().trim();
                    channelName = $('#channelName').val().trim();
                }
                
                config = {
                    appId: ENV_CONFIG.appId,
                    clientId: ENV_CONFIG.clientId,
                    clientSecret: ENV_CONFIG.clientSecret,
                    agentRtcUid: $('#agentRtcUid').val(),
                    agoraTokenType: tokenType,
                    agoraToken: agoraToken,
                    agoraTokenUrl: agoraTokenUrl,
                    channelName: channelName, // æ·»åŠ é¢‘é“åç§°åˆ°é…ç½®
                    // LLMé…ç½®
                    llm: {
                        url: $('#llmUrl').val(),
                        api_key: $('#llmApiKey').val(),
                        model: $('#llmModel').val(),
                        prompt: $('#llmPrompt').val(),
                        greeting_message: $('#llmGreeting').val(),
                        max_token: parseInt($('#llmMaxToken').val())
                    },
                    // VADé…ç½®
                    vad: {
                        interrupt_duration_ms: parseInt($('#vadInterruptDuration').val()),
                        prefix_padding_ms: parseInt($('#vadPrefixPadding').val()),
                        silence_duration_ms: parseInt($('#vadSilenceDuration').val()),
                        threshold: parseFloat($('#vadThreshold').val()),
                        enable_aivad: $('#vadEnableAivad').is(':checked')
                    },
                    // TTSé…ç½®
                    tts: ttsConfig
                };
                logDebug('é…ç½®å·²ä¿å­˜');
                
                // åªæœ‰åœ¨æ˜ç¡®è¦æ±‚æ—¶æ‰æ˜¾ç¤ºä¿å­˜æˆåŠŸæç¤º
                if (showToastMessage) {
                    showToast('é…ç½®ä¿å­˜æˆåŠŸï¼', 'success');
                }
                
                return config;
            }

            // ç”ŸæˆBasicè®¤è¯å¤´
            function generateBasicAuth(clientId, clientSecret) {
                if (!clientId || !clientSecret) {
                    logError('å®¢æˆ·IDæˆ–å®¢æˆ·å¯†é’¥ä¸ºç©ºï¼Œæ— æ³•ç”Ÿæˆè®¤è¯ä¿¡æ¯');
                    return '';
                }
                
                // åˆ›å»ºBase64ç¼–ç çš„è®¤è¯å­—ç¬¦ä¸²
                const authString = btoa(clientId + ':' + clientSecret);
                return 'Basic ' + authString;
            }

            // ç”Ÿæˆéšæœºé¢‘é“å
            function generateRandomChannelName() {
                const prefix = "convaiconsole_";
                const randomNum = Math.floor(Math.random() * 1000000);
                return prefix + randomNum;
            }

            // è·å–RTC Tokenï¼ˆä¼˜å…ˆä½¿ç”¨ç”¨æˆ·è¾“å…¥çš„Tokenï¼Œå¦åˆ™ä»åç«¯è·å–ï¼‰
            async function getRtcToken(channelName) {
                const tokenType = $('input[name="agoraTokenType"]:checked').val();
                if (tokenType === 'temp') {
                    const userToken = $('#agoraToken').val().trim();
                    logDebug(`ä½¿ç”¨ç”¨æˆ·è¾“å…¥çš„Token: ${userToken.substring(0, 20)}...`);
                    return userToken;
                    } else {
                    const tokenUrl = $('#agoraTokenUrl').val().trim() || 'http://localhost:8081/rtcToken';
                    try {
                        logDebug('ä»åç«¯è·å–RTC Token...');
                    const response = await $.ajax({
                            url: `${tokenUrl}?channelName=${channelName}`,
                        type: 'GET'
                    });
                    if (response && response.key) {
                            const token = response.key;
                            logDebug(`æˆåŠŸè·å–RTC Token: ${token.substring(0, 20)}...`);
                            return token;
                    } else {
                            throw new Error('åç«¯è¿”å›çš„æ•°æ®ä¸­æ²¡æœ‰token');
                    }
                } catch (error) {
                        logError(`è·å–RTC Tokenå¤±è´¥: ${error}`);
                        throw error;
                    }
                }
            }
            
            // åˆ›å»ºæ™ºèƒ½ä½“
            async function createAgent() {
                logDebug('åˆ›å»ºæ™ºèƒ½ä½“...');
                $('#createAgentBtn').prop('disabled', true);
                    
                // ä¿å­˜å½“å‰é…ç½®
                saveConfig();
                    
                let newChannelName = '';
                const tokenType = $('input[name="agoraTokenType"]:checked').val();
                if (tokenType === 'temp') {
                    newChannelName = $('#channelName').val().trim();
                } else {
                    newChannelName = generateRandomChannelName();
                    $('#channelName').val(newChannelName);
                }
                logDebug(`ä¸ºæ™ºèƒ½ä½“ä½¿ç”¨é¢‘é“: ${newChannelName}`);
                config.channelName = newChannelName;
                
                try {
                    // ä»åç«¯è·å–RTC Token
                    const token = await getRtcToken(newChannelName);
                    config.token = token;
                    
                    let apiUrl = `/api/agora/api/conversational-ai-agent/v2/projects/${config.appId}/join`;
                
                    // æ„å»ºè¯·æ±‚ä½“
                const requestBody = {
                        name: config.channelName,
                    properties: {
                            channel: config.channelName,
                            token: config.token,
                        agent_rtc_uid: config.agentRtcUid,
                        remote_rtc_uids: ["*"],
                        enable_string_uid: true,
                            idle_timeout: 30,
                            join_rtc_channel: true,
                            rtc_channel: config.channelName,
                            rtc_token: config.token,
                        llm: {
                            url: config.llm.url,
                            api_key: config.llm.api_key,
                            max_history: 100,
                            system_messages: [
                                {
                                    role: "system",
                                    content: config.llm.prompt
                                }
                            ],
                            params: {
                                model: config.llm.model,
                                max_token: config.llm.max_token
                            },
                            greeting_message: config.llm.greeting_message,
                            failure_message: "å¯¹ä¸èµ·ï¼Œæˆ‘å‡ºé”™äº†"
                        },
                        asr: {
                            language: "zh-CN"
                        },
                        vad: {
                            interrupt_duration_ms: config.vad.interrupt_duration_ms,
                            prefix_padding_ms: config.vad.prefix_padding_ms,
                            silence_duration_ms: config.vad.silence_duration_ms,
                            threshold: config.vad.threshold
                        },
                        tts: config.tts,
                        parameters: {
                            transcript: {
                                enable: true,
                                protocol_version: "v2",
                                enable_words: false,
                                redundant: false
                            },
                            enable_metrics: true,
                            audio_scenario: "default"
                        },
                        advanced_features: {
                            enable_aivad: config.vad.enable_aivad
                        }
                    }
                };

                // æ˜¾ç¤ºè¯·æ±‚æ•°æ®
                $('#requestContent').text(JSON.stringify(requestBody, null, 2));
                
                    const response = await $.ajax({
                    url: apiUrl,
                    type: 'POST',
                    contentType: 'application/json',
                    headers: {
                        'Authorization': generateBasicAuth(config.clientId, config.clientSecret)
                    },
                        data: JSON.stringify(requestBody)
                    });
                    
                        logDebug('APIå“åº”æˆåŠŸ');
                        $('#responseContent').text(JSON.stringify(response, null, 2));
                        
                        if (response.agent_id) {
                            agentId = response.agent_id;
                            logDebug(`æ™ºèƒ½ä½“åˆ›å»ºæˆåŠŸï¼ŒID: ${agentId}`);
                            $('#agentId').text(agentId);
                            updateAgentStatus(true);
                        return agentId;
                        } else {
                            logError('åˆ›å»ºæ™ºèƒ½ä½“å¤±è´¥: å“åº”ä¸­æ²¡æœ‰agent_id');
                        $('#createAgentBtn').prop('disabled', false);
                        return null;
                        }
                } catch (error) {
                        logError(`åˆ›å»ºæ™ºèƒ½ä½“è¯·æ±‚å¤±è´¥: ${error}`);
                    
                    if (error.status === 401) {
                            logError('è®¤è¯å¤±è´¥(401)ï¼šè¯·æ£€æŸ¥Tokenæ˜¯å¦æ­£ç¡®æˆ–å·²è¿‡æœŸ');
                        }
                        
                    let errorResponse;
                    try {
                        errorResponse = error.responseText ? JSON.parse(error.responseText) : {};
                    } catch (e) {
                        errorResponse = { error: "è§£æé”™è¯¯å“åº”å¤±è´¥" };
                    }
                        
                        // å¤„ç†ä»»åŠ¡å†²çªé”™è¯¯
                        if (errorResponse.reason === "TaskConflict" && errorResponse.agent_id) {
                            logDebug(`æ£€æµ‹åˆ°æ™ºèƒ½ä½“å·²å­˜åœ¨ï¼ŒID: ${errorResponse.agent_id}`);
                            agentId = errorResponse.agent_id;
                            $('#agentId').text(agentId);
                            updateAgentStatus(true);
                            logDebug('å·²è‡ªåŠ¨ä½¿ç”¨ç°æœ‰æ™ºèƒ½ä½“');
                        return agentId;
                        }
                        
                    logError(`è¯¦ç»†é”™è¯¯ä¿¡æ¯: ${error.responseText || 'æ— è¯¦ç»†é”™è¯¯ä¿¡æ¯'}`);
                    $('#responseContent').text(error.responseText || 'æ— å“åº”æ•°æ®');
                    $('#createAgentBtn').prop('disabled', false);
                    return null;
                }
            }
            
            // åœæ­¢æ™ºèƒ½ä½“
            async function stopAgent() {
                if (!agentId) {
                    logError('æ™ºèƒ½ä½“IDä¸ºç©ºï¼Œæ— æ³•åœæ­¢');
                    return;
                }
                
                logDebug(`åœæ­¢æ™ºèƒ½ä½“: ${agentId}`);
                $('#stopAgentBtn').prop('disabled', true);
                
                let apiUrl = `/api/agora/api/conversational-ai-agent/v2/projects/${config.appId}/agents/${agentId}/leave`;
                
                // æ˜¾ç¤ºè¯·æ±‚æ•°æ®
                $('#requestContent').text('POST ' + apiUrl);
                
                try {
                    const response = await $.ajax({
                    url: apiUrl,
                    type: 'POST',
                    headers: {
                        'Authorization': generateBasicAuth(config.clientId, config.clientSecret)
                        }
                    });
                    
                        logDebug('åœæ­¢æ™ºèƒ½ä½“æˆåŠŸ');
                        $('#responseContent').text(JSON.stringify(response, null, 2));
                        updateAgentStatus(false);
                } catch (error) {
                        logError(`åœæ­¢æ™ºèƒ½ä½“è¯·æ±‚å¤±è´¥: ${error}`);
                    $('#responseContent').text(error.responseText || 'æ— å“åº”æ•°æ®');
                        $('#stopAgentBtn').prop('disabled', false);
                    }
            }
            
            // æ›´æ–°æ™ºèƒ½ä½“çŠ¶æ€UI
            function updateAgentStatus(isActive) {
                if (isActive) {
                    $('#agentStatusIndicator').removeClass('status-inactive').addClass('status-active');
                    $('#agentStatusText').text('æ´»è·ƒ');
                    $('#createAgentBtn').prop('disabled', true);
                    $('#stopAgentBtn').prop('disabled', false);
                    $('#startAudioBtn').prop('disabled', false);
                    
                    // è‡ªåŠ¨åˆå§‹åŒ–RTCå®¢æˆ·ç«¯
                    initializeRtcClient();
                } else {
                    $('#agentStatusIndicator').removeClass('status-active').addClass('status-inactive');
                    $('#agentStatusText').text('éæ´»è·ƒ');
                        $('#createAgentBtn').prop('disabled', false);
                        $('#stopAgentBtn').prop('disabled', true);
                    $('#startAudioBtn').prop('disabled', true);
                    $('#stopAudioBtn').prop('disabled', true);
                }
            }
            
            // æ·»åŠ è°ƒè¯•æ—¥å¿—
            function logDebug(message) {
                const now = new Date();
                const timeStr = now.toLocaleTimeString();
                $('#debugPanel').append(`<div class="text-info">[${timeStr}] ${message}</div>`);
                scrollDebugToBottom();
            }
            
            // æ·»åŠ é”™è¯¯æ—¥å¿—
            function logError(message) {
                const now = new Date();
                const timeStr = now.toLocaleTimeString();
                $('#debugPanel').append(`<div class="text-danger">[${timeStr}] ${message}</div>`);
                scrollDebugToBottom();
            }
            
            // æ»šåŠ¨è°ƒè¯•é¢æ¿åˆ°åº•éƒ¨
            function scrollDebugToBottom() {
                const debugPanel = document.getElementById('debugPanel');
                debugPanel.scrollTop = debugPanel.scrollHeight;
            }
            
            // ===== éŸ³é¢‘äº¤äº’ç›¸å…³ä»£ç  =====
            let rtcClient = null;
            let localAudioTrack = null;
            let remoteAudioTrack = null;
            let isJoined = false;
            
            // åˆå§‹åŒ–RTCå®¢æˆ·ç«¯
            async function initializeRtcClient() {
                try {
                    logDebug('åˆå§‹åŒ–RTCå®¢æˆ·ç«¯...');
                    
                    // åˆ›å»ºRTCå®¢æˆ·ç«¯å®ä¾‹
                    rtcClient = AgoraRTC.createClient({ mode: "rtc", codec: "vp8" });
                    
                    // æ³¨å†Œäº‹ä»¶å¤„ç†ç¨‹åº
                    rtcClient.on("user-published", handleUserPublished);
                    rtcClient.on("user-unpublished", handleUserUnpublished);
                    
                    logDebug('RTCå®¢æˆ·ç«¯åˆå§‹åŒ–æˆåŠŸ');
                    return true;
                } catch (error) {
                    logError(`RTCå®¢æˆ·ç«¯åˆå§‹åŒ–å¤±è´¥: ${error.message}`);
                    return false;
                }
            }
            
            // å¼€å§‹éŸ³é¢‘å¯¹è¯
            async function startAudioInteraction() {
                try {
                    if (!agentId) {
                        logError('è¯·å…ˆåˆ›å»ºæ™ºèƒ½ä½“');
                        return;
                    }
                    
                    if (!config.token) {
                        logError('Tokenæœªè®¾ç½®ï¼Œè¯·å…ˆåˆ›å»ºæ™ºèƒ½ä½“');
                        return;
                    }
                    
                    logDebug(`éŸ³é¢‘å¯¹è¯ä½¿ç”¨é¢‘é“: ${config.channelName}`);
                    logDebug(`éŸ³é¢‘å¯¹è¯ä½¿ç”¨Token: ${config.token.substring(0, 20)}...`);
                    
                    if (rtcClient === null) {
                        if (!await initializeRtcClient()) {
                            return;
                        }
                    }
                    
                    logDebug('åŠ å…¥RTCé¢‘é“...');
                    $('#startAudioBtn').prop('disabled', true);
                    
                    // åˆ›å»ºæœ¬åœ°éŸ³é¢‘è½¨é“
                    localAudioTrack = await AgoraRTC.createMicrophoneAudioTrack();
                    
                    // è·å–éšæœºuid
                    const uid = Math.floor(Math.random() * 100000);
                    
                    // åŠ å…¥é¢‘é“
                    await rtcClient.join(config.appId, config.channelName, config.token, uid);
                    isJoined = true;
                    
                    // å‘å¸ƒæœ¬åœ°éŸ³é¢‘è½¨é“
                    await rtcClient.publish([localAudioTrack]);
                    
                    // å¯åŠ¨éŸ³é‡ç›‘æµ‹
                    startVolumeDetection();
                    
                    // æ›´æ–°UIçŠ¶æ€
                    $('#audioStatusText').text('å¯¹è¯ä¸­');
                    $('#audioStatusIndicator').removeClass('status-inactive').addClass('status-active');
                    $('#startAudioBtn').prop('disabled', true);
                    $('#stopAudioBtn').prop('disabled', false);
                    
                    logDebug('éŸ³é¢‘å¯¹è¯å·²å¼€å§‹');
                } catch (error) {
                    logError(`å¼€å§‹éŸ³é¢‘å¯¹è¯å¤±è´¥: ${error.message}`);
                    if (localAudioTrack) {
                        localAudioTrack.close();
                        localAudioTrack = null;
                    }
                    
                    if (isJoined) {
                        try {
                            await rtcClient.leave();
                            isJoined = false;
                        } catch (e) {
                            logError(`ç¦»å¼€é¢‘é“å¤±è´¥: ${e.message}`);
                        }
                    }
                    
                    $('#startAudioBtn').prop('disabled', false);
                }
            }
            
            // ç»“æŸéŸ³é¢‘å¯¹è¯
            async function stopAudioInteraction() {
                try {
                    logDebug('ç»“æŸéŸ³é¢‘å¯¹è¯...');
                    $('#stopAudioBtn').prop('disabled', true);
                    
                    // åœæ­¢éŸ³é‡ç›‘æµ‹
                    stopVolumeDetection();
                    
                    // å…³é—­æœ¬åœ°éŸ³é¢‘è½¨é“
                    if (localAudioTrack) {
                        localAudioTrack.close();
                        localAudioTrack = null;
                    }
                    
                    // ç¦»å¼€é¢‘é“
                    if (rtcClient && isJoined) {
                        await rtcClient.leave();
                        isJoined = false;
                    }
                    
                    // æ›´æ–°UIçŠ¶æ€
                    $('#audioStatusText').text('å·²æ–­å¼€');
                    $('#audioStatusIndicator').removeClass('status-active').addClass('status-inactive');
                    $('#startAudioBtn').prop('disabled', false);
                    $('#stopAudioBtn').prop('disabled', true);
                    
                    logDebug('éŸ³é¢‘å¯¹è¯å·²ç»“æŸ');
                } catch (error) {
                    logError(`ç»“æŸéŸ³é¢‘å¯¹è¯å¤±è´¥: ${error.message}`);
                    $('#stopAudioBtn').prop('disabled', false);
                }
            }
            
            // å¤„ç†è¿œç¨‹ç”¨æˆ·å‘å¸ƒçš„åª’ä½“æµ
            async function handleUserPublished(user, mediaType) {
                logDebug(`è¿œç¨‹ç”¨æˆ· ${user.uid} å‘å¸ƒäº† ${mediaType} æµ`);
                
                // è®¢é˜…è¿œç¨‹ç”¨æˆ·çš„éŸ³é¢‘æµ
                if (mediaType === 'audio') {
                    remoteAudioTrack = await rtcClient.subscribe(user, mediaType);
                    remoteAudioTrack.play();
                    logDebug(`å·²è®¢é˜…å¹¶æ’­æ”¾è¿œç¨‹ç”¨æˆ· ${user.uid} çš„éŸ³é¢‘`);
                }
            }
            
            // å¤„ç†è¿œç¨‹ç”¨æˆ·å–æ¶ˆå‘å¸ƒçš„åª’ä½“æµ
            function handleUserUnpublished(user, mediaType) {
                logDebug(`è¿œç¨‹ç”¨æˆ· ${user.uid} å–æ¶ˆå‘å¸ƒäº† ${mediaType} æµ`);
                if (mediaType === 'audio') {
                    remoteAudioTrack = null;
                }
            }
            
            // éŸ³é‡ç›‘æµ‹
            let volumeDetectionInterval = null;
            
            function startVolumeDetection() {
                if (localAudioTrack) {
                    volumeDetectionInterval = setInterval(() => {
                        const volume = localAudioTrack.getVolumeLevel() * 100;
                        $('#volumeIndicator').css('width', `${volume}%`);
                    }, 100);
                }
            }
            
            function stopVolumeDetection() {
                if (volumeDetectionInterval) {
                    clearInterval(volumeDetectionInterval);
                    volumeDetectionInterval = null;
                    $('#volumeIndicator').css('width', '0%');
                }
            }
            
            // TTSæœåŠ¡å•†åˆ‡æ¢å¤„ç†
            function handleTtsVendorChange() {
                const vendor = $('#ttsVendor').val();
                if (vendor === 'bytedance') {
                    $('#ttsBytedanceConfig').show();
                    $('#ttsTencentConfig').hide();
                } else if (vendor === 'tencent') {
                    $('#ttsBytedanceConfig').hide();
                    $('#ttsTencentConfig').show();
                }
            }
            
            // ç»‘å®šTokenè·å–æ–¹å¼åˆ‡æ¢äº‹ä»¶
            $('#agoraTokenTypeTemp').change(function() {
                if ($(this).is(':checked')) {
                    $('#agoraTokenInputBox').show();
                    $('#agoraChannelNameBox').show(); // æ˜¾ç¤ºé¢‘é“åç§°è¾“å…¥æ¡†
                    $('#agoraTokenUrlBox').hide();
                } else {
                    $('#agoraChannelNameBox').hide(); // éšè—é¢‘é“åç§°è¾“å…¥æ¡†
                }
            });
            $('#agoraTokenTypeApi').change(function() {
                if ($(this).is(':checked')) {
                    $('#agoraTokenInputBox').hide();
                    $('#agoraChannelNameBox').hide(); // éšè—é¢‘é“åç§°è¾“å…¥æ¡†
                    $('#agoraTokenUrlBox').show();
                }
            });
            
            // è°ƒæ•´å¸ƒå±€
            function adjustLayout() {
                const debugSection = $('#debugSection');
                const mainContent = $('#mainContent');
                
                if (debugSection.is(':visible')) {
                    // æœ‰è°ƒè¯•çª—å£æ—¶ï¼Œä½¿ç”¨åŒåˆ—å¸ƒå±€
                    mainContent.removeClass('col-md-8 col-lg-6').addClass('col-md-6');
                } else {
                    // æ²¡æœ‰è°ƒè¯•çª—å£æ—¶ï¼Œä¸»å†…å®¹å±…ä¸­
                    mainContent.removeClass('col-md-6').addClass('col-md-8 col-lg-6');
                }
            }
            
            // åˆ‡æ¢è°ƒè¯•çª—å£æ˜¾ç¤º
            function toggleDebugSection() {
                const debugSection = $('#debugSection');
                debugSection.toggle();
                adjustLayout();
            }
            
            // æ˜¾ç¤ºToastæç¤º
            function showToast(message, type = 'info') {
                // åˆ›å»ºToastå®¹å™¨ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
                let toastContainer = $('#toastContainer');
                if (toastContainer.length === 0) {
                    $('body').append('<div id="toastContainer" style="position: fixed; top: 20px; right: 20px; z-index: 9999;"></div>');
                    toastContainer = $('#toastContainer');
                }
                
                // æ ¹æ®ç±»å‹è®¾ç½®æ ·å¼
                let bgClass = 'bg-info';
                let icon = 'â„¹ï¸';
                if (type === 'success') {
                    bgClass = 'bg-success';
                    icon = 'âœ…';
                } else if (type === 'error') {
                    bgClass = 'bg-danger';
                    icon = 'âŒ';
                } else if (type === 'warning') {
                    bgClass = 'bg-warning';
                    icon = 'âš ï¸';
                }
                
                // åˆ›å»ºToastå…ƒç´ 
                const toastId = 'toast_' + Date.now();
                const toastHtml = `
                    <div id="${toastId}" class="toast show ${bgClass} text-white" role="alert" style="min-width: 250px;">
                        <div class="toast-body d-flex align-items-center">
                            <span class="me-2">${icon}</span>
                            <span>${message}</span>
                        </div>
                    </div>
                `;
                
                // æ·»åŠ åˆ°å®¹å™¨
                toastContainer.append(toastHtml);
                
                // 3ç§’åè‡ªåŠ¨ç§»é™¤
                setTimeout(() => {
                    $(`#${toastId}`).fadeOut(300, function() {
                        $(this).remove();
                    });
                }, 3000);
            }
            
            // åˆå§‹åŒ–
            function init() {
                // æ£€æŸ¥ç¯å¢ƒå˜é‡é…ç½®
                if (!checkEnvConfig()) {
                    return;
                }
                
                // ä¿å­˜åˆå§‹é…ç½®ï¼ˆä¸æ˜¾ç¤ºæç¤ºï¼‰
                saveConfig(false);
                
                                // ç»‘å®šæŒ‰é’®äº‹ä»¶
                $('#createAgentBtn').click(createAgent);
                $('#stopAgentBtn').click(stopAgent);
            $('#startAudioBtn').click(startAudioInteraction);
            $('#stopAudioBtn').click(stopAudioInteraction);
                $('#saveConfigBtn').click(function() {
                    saveConfig(true); // æ˜¾ç¤ºä¿å­˜æˆåŠŸæç¤º
                });
                
                // ç»‘å®šTTSæœåŠ¡å•†åˆ‡æ¢äº‹ä»¶
                $('#ttsVendor').change(handleTtsVendorChange);
                
                // ç»‘å®šTokenè·å–æ–¹å¼åˆ‡æ¢äº‹ä»¶
                $('#agoraTokenTypeTemp').change(function() {
                    if ($(this).is(':checked')) {
                        $('#agoraTokenInputBox').show();
                        $('#agoraChannelNameBox').show(); // æ˜¾ç¤ºé¢‘é“åç§°è¾“å…¥æ¡†
                        $('#agoraTokenUrlBox').hide();
                    } else {
                        $('#agoraChannelNameBox').hide(); // éšè—é¢‘é“åç§°è¾“å…¥æ¡†
                    }
                });
                $('#agoraTokenTypeApi').change(function() {
                    if ($(this).is(':checked')) {
                        $('#agoraTokenInputBox').hide();
                        $('#agoraChannelNameBox').hide(); // éšè—é¢‘é“åç§°è¾“å…¥æ¡†
                        $('#agoraTokenUrlBox').show();
                    }
                });
                
                // åˆå§‹åŒ–TTSé…ç½®æ˜¾ç¤º
                handleTtsVendorChange();
                
                // è°ƒæ•´å¸ƒå±€
                adjustLayout();
                
                // åˆå§‹åŒ–æ‰€æœ‰tooltip
                var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
                var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                    return new bootstrap.Tooltip(tooltipTriggerEl);
                });
                
                logDebug('é¡µé¢åŠ è½½å®Œæˆ');
                updateAgentStatus(false);
            }
            
            // åˆå§‹åŒ–åº”ç”¨
            init();
            
            // å°†æ—¥å¿—å‡½æ•°æš´éœ²åˆ°å…¨å±€ï¼Œæ–¹ä¾¿æ§åˆ¶å°è°ƒè¯•
            window.logDebug = logDebug;
            window.logError = logError;
            window.toggleDebugSection = toggleDebugSection;
            window.showToast = showToast;
        });
    </script>
</body>
</html>
